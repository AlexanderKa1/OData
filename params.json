{"name":"maskx.OData","tagline":"Dynamic generate OData Controller from SQL Server","body":"# maskx.Odata\r\nDynamic generate OData Controller from SQL server.\r\n\r\n# Nuget\r\n\r\n# Usage\r\n## SQL Config\r\nexecute the database initial script：(at folder Sql/initialScript/ )\r\n    GetEdmFuncInfo.sql\r\n    GetEdmModelInfo.sql \r\n    GetEdmRelationship.sql  \r\n    GetEdmTVFInfo.sql\r\n\r\n## Server config\r\n1 In OWIN Startup class Configuration function add follow code： \r\n\r\n`config.Routes.MapDynamicODataServiceRoute(\"odata\",\"odata\");`\r\n `DynamicOData.AddDataSource(new maskx.Data.OData.DataSource.SqlDataSource(\"db\", Common.Utilities.ConnectionString));`\r\n\r\n## Client usage\r\n###Query：\r\n\t$.get('odata/db/<表/视图/表值函数()>/<查询条件>')\t\t\r\n\t查询条件参考：\r\n\t\thttp://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api/supporting-odata-query-options\t\r\n\t\thttp://docs.oasis-open.org/odata/odata/v4.0/errata02/os/complete/part2-url-conventions/odata-v4.0-errata02-os-part2-url-conventions-complete.html#_Toc406398094\r\n\t返回值：\r\n\t\tdata.value 是查询的结果集\r\n\r\n查询可以使用封装好的类库： 'common/search'\r\nsearch.js 使用方法：\r\n1. 参考 \\Scripts\\app\\train\\home.js 添加search.js 引用\r\n2. 创建Search实例，需要两个参数,形如： new search('tablename','name desc')\r\n\t1) 表/视图/表值函数() 名称\r\n\t2) 排序方式， 形如 'Name desc'\r\n3. 调用Search() 方法执行查询，Search方法有个一个可选参数，当设定为fasle时，将不查询总的记录数, 此种调用适用于改变排序方式等不影响查询结果数量的操作，可以减轻服务端的压力\r\n4. searrch.js \r\n\t属性说明：\r\n\t\t名称\t\t\t\t类型\t\t\t\t\t说明\r\n\t\tFilter\t\t\tArray\t\t\t\t查询条件，多个条件以 and 连接\r\n\t\tOrderBy\t\tstring\t\t\t\t排序条件\r\n\t\tRowCount\t\tobservable\t\t\t每页的数据条目数量\r\n\t\tTotalCount\t\tobservable\t\t\t总数据条目数\r\n\t\tTotalPages\t\tobservableArray\t\t分页数量\r\n\t\tNavigatePages\tobservableArray\t\t展示层显示的导航页面数\r\n\t\tCurrentPage\t\tobservable\t\t\t当前显示的页面号\r\n\t\tResult\t\t\tobservableArray\t\t查询结果\r\n\t\tHasNext\t\tobservable\t\t\t是否还有下一页\r\n\t\tHasPre\t\t\tobservable\t\t\t是否还有上一页\r\n\t方法说明：\t\t\r\n\t\t1.\tSearch\t\t\t执行到服务端查询数据操作\t\t\t\t\t\r\n\t\t\t参数：\r\n\t\t\t\tincludeCount\t是否要返回总的数据条目数，当设定为fasle时，将不查询总的记录数, 此种调用适用于改变排序方式等不影响查询结果数量的操作，可以减轻服务端的压力\r\n\t\t\t返回值：\r\n\t\t\t\t无，查询结果将更新到 Result属性\r\n\t\t2.\tGoPage\t\t\t跳转到指定页码\r\n\t\t\t参数：\r\n\t\t\t\tp\t\t\t\t要跳转到的页码\r\n\t\t\t返回值：\r\n\t\t\t\t无，查询结果将更新到 Result属性\r\n\t\t3.\tGoNext\t\t\t跳转到下一页\r\n\t\t4.\tGoPre\t\t\t跳转到上一页\r\n\t\t5.\tGoFirst\t\t跳转到第一页\r\n\t\t6.\tGoLast\t\t\t跳转到最后一页\r\n\r\n存储过程调用：\r\n\t$.post('odata/db/<存储过程名()>',<存储过程参数>)\t\t存储过程参数 为json对象，name 是存储过程参数名，value是存储过程参数的值\r\n\t返回值：\r\n\t\t1.\t当存储过程没有输出参数时\r\n\t\t\t\tdata.value 是存储过程返回的结果集\r\n\t\t2.\t当存储过程有输出参数时：\r\n\t\t\t\tdata.<输出参数名>\t\t是存储过程返回的输出参数值\r\n\t\t\t\tdata.$Result\t\t是存储过程返回的结果集\r\n标量函数调用：\r\n\t\t略\r\n\r\n\r\nOData webapi 权限控制：\r\n对OData WebApi的访问控制在表Authorization中配置\r\n字段说明：\r\n\tRole：\t角色名称，Anonymous 代表匿名用户， 其他角色为AspNetRoles表中角色名(Name 字段)\r\n\tAction：\t对应WebApi的操作：\r\n\t\t值\t\t\t\t\t对应WebApi操作\r\n\t\tCount\t\t\t\t$count\r\n\t\tFunc\t\t\t\t存储过程调用/标量函数调用\r\n\t\tFuncResultCount\t\t表值函数查询使用 $count\r\n\t\tGet\t\t\t\t\tGet 查询\r\n\tTarget：\t数据对象名（表名/视图名/存储过程名/函数名）","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}